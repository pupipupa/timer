<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyTime - assistant pour étudier</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Chart.js pour les statistiques -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="pixel-bg"></div>
    
    <!-- Écran de connexion -->
    <div id="login-screen" class="screen active">
        <div class="window login-window">
            <div class="window-header">
                <span class="window-title">StudyTime</span>
                <button class="window-btn close-btn"></button>
            </div>
            <div class="window-content">
                <div class="pixel-logo">
                    <div class="logo-heart"></div>
                    <h1>StudyTime</h1>
                    <p class="subtitle">assistant pour étudier</p>
                </div>
                
                <form id="login-form" class="auth-form">
                    <div class="form-group">
                        <label for="username">Nom d'utilisateur</label>
                        <input type="text" id="username" class="pixel-input" placeholder="Entrez votre nom..." required>
                    </div>
                    <div class="form-group">
                        <label for="password">Mot de passe</label>
                        <input type="password" id="password" class="pixel-input" placeholder="••••••••" required>
                    </div>
                    <button type="submit" class="pixel-btn primary">Se connecter</button>
                    <button type="button" id="signup-btn" class="pixel-btn secondary">Créer un compte</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Écran principal -->
    <div id="main-screen" class="screen">
        <!-- Barre de navigation -->
        <nav class="nav-bar">
            <div class="nav-brand">
                <span class="nav-logo">ST</span>
                <span>StudyTime</span>
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" data-tab="timer">⏰ Minuteur</button>
                <button class="nav-btn" data-tab="statistics">📊 Statistiques</button>
                <button class="nav-btn" data-tab="achievements">🏅 Succès</button>
                <button class="nav-btn" data-tab="tournaments">⚔️ Tournois</button>
                <button class="nav-btn" data-tab="leaderboards">🏅 Classements</button>
                <button class="nav-btn" data-tab="friends">🤝 Amis</button>
                <button class="nav-btn" data-tab="githubsync">🐙 GitHub</button>
                <button class="nav-btn" data-tab="settings">⚙️ Paramètres</button>
                <button class="nav-btn" data-tab="profile">👤 Profil</button>
                <button id="logout-btn" class="nav-btn logout">🚪 Déconnexion</button>
            </div>
        </nav>

        <!-- Contenu principal -->
        <main class="main-content">
            <!-- Onglet Minuteur -->
            <div id="timer-tab" class="tab-content active">
                <div class="timer-container">
                    <div class="timer-header">
                        <h2>⏰ Minuteur</h2>
                        <select id="timer-type" class="pixel-select">
                            <option value="pomodoro">Pomodoro</option>
                            <option value="deep">Concentration Profonde</option>
                            <option value="sprint">Sprint Rapide</option>
                            <option value="custom">Personnalisé</option>
                        </select>
                    </div>

                    <div class="timer-display">
                        <div class="timer-circle">
                            <div class="progress-ring">
                                <div id="progress-fill" class="progress-fill"></div>
                            </div>
                            <div class="timer-info">
                                <div id="timer-session" class="session-type">Travail</div>
                                <div id="time-display" class="time">25:00</div>
                                <div id="current-timer-type" class="timer-type-display">Pomodoro</div>
                            </div>
                        </div>
                    </div>

                    <div class="timer-controls">
                        <button id="start-btn" class="control-btn start">▶</button>
                        <button id="pause-btn" class="control-btn pause hidden">⏸</button>
                        <button id="stop-btn" class="control-btn stop">⏹</button>
                        <button id="skip-btn" class="control-btn skip">⏭</button>
                    </div>
                </div>

                <!-- Statistiques quotidiennes -->
                <div class="daily-stats">
                    <h3>📊 Aujourd'hui</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">🔥</div>
                            <div class="stat-info">
                                <div class="stat-value" id="current-streak">7</div>
                                <div class="stat-label">jours consécutifs</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">⏱</div>
                            <div class="stat-info">
                                <div class="stat-value"><span id="today-time">0</span> min</div>
                                <div class="stat-label">aujourd'hui</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">✅</div>
                            <div class="stat-info">
                                <div class="stat-value" id="sessions-completed">24</div>
                                <div class="stat-label">sessions</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🎯</div>
                            <div class="stat-info">
                                <div class="stat-value"><span id="completion-rate">73</span> %</div>
                                <div class="stat-label">complétion</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Succès récents -->
                <div class="recent-achievements">
                    <h3>🏅 Succès</h3>
                    <div id="recent-achievements" class="achievement-badges">
                        <div class="achievement-badge">
                            <span class="achievement-icon">🏆</span>
                            <span class="achievement-name">Premier Minuteur</span>
                        </div>
                        <div class="achievement-badge">
                            <span class="achievement-icon">🔥</span>
                            <span class="achievement-name">Série de 5</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Statistiques -->
            <div id="statistics-tab" class="tab-content">
                <h2>📈 Statistiques Détaillées</h2>
                
                <div class="stats-section">
                    <h3>⚡ Efficacité - Semaine</h3>
                    <div id="chart-week" class="chart-container">
                        <canvas></canvas>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>📊 Sessions: Complètes vs Interrompues</h3>
                    <div class="completion-stats">
                        <div class="completion-item">
                            <span class="completion-number" id="complete-sessions">18</span>
                            <span class="completion-label">sessions complètes</span>
                        </div>
                        <div class="completion-item">
                            <span class="completion-number" id="interrupted-sessions">6</span>
                            <span class="completion-label">sessions interrompues</span>
                        </div>
                    </div>
                    <div class="time-comparison">
                        <p>Temps réel: <span id="real-time">1450</span> min</p>
                        <p>Temps prévu: <span id="planned-time">1800</span> min</p>
                    </div>
                    <div id="chart-completion" class="chart-container">
                        <canvas></canvas>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>📊 Distribution par Matière</h3>
                    <div id="chart-categories" class="chart-container">
                        <canvas></canvas>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>🔬 Analyse des Pauses</h3>
                    <div id="chart-correlation" class="chart-container">
                        <canvas></canvas>
                    </div>
                </div>
            </div>

            <!-- Onglet Tournois -->
            <div id="tournaments-tab" class="tab-content">
                <h2>⚔️ Tournois et Compétitions</h2>
                
                <div class="tournament-section">
                    <h3>Tournoi Actuel: <span id="weekly-t-name">Défi Focus Hebdomadaire</span></h3>
                    <div class="tournament-info">
                        <p><strong>Catégories:</strong> Débutant, Avancé, Expert</p>
                        <p><strong>Prix:</strong> 500, 300, 200 points</p>
                    </div>
                    <button id="register-weekly" class="pixel-btn primary">S'inscrire</button>
                </div>

                <div class="tournament-section">
                    <h3>Classement du Tournoi</h3>
                    <div id="bracket-container" class="bracket-container">
                        <p>Les participants seront affichés après l'inscription</p>
                    </div>
                </div>
            </div>

            <!-- Onglet Classements -->
            <div id="leaderboards-tab" class="tab-content">
                <h2>🏅 Classements Globaux</h2>
                
                <div class="leaderboard-section">
                    <table id="global-leaderboard" class="pixel-table">
                        <thead>
                            <tr>
                                <th>Rang</th>
                                <th>Nom</th>
                                <th>Points</th>
                                <th>Ligue</th>
                                <th>Etudes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Les données seront insérées dynamiquement -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Onglet Amis -->
            <div id="friends-tab" class="tab-content">
                <h2>🤝 Amis et Équipes</h2>
                
                <div class="friends-section">
                    <h3>Ajouter des amis</h3>
                    <form id="add-friend-form" class="friend-form">
                        <input type="text" id="friend-username" class="pixel-input" placeholder="Nom d'utilisateur">
                        <button type="submit" class="pixel-btn primary">Ajouter</button>
                    </form>
                </div>

                <div class="friends-list">
                    <h3>Mes amis</h3>
                    <div id="friends-list-container">
                        <!-- Les amis seront ajoutés dynamiquement -->
                    </div>
                </div>

                <div class="group-study">
                    <h3>Étude en groupe</h3>
                    <div id="group-streak">
                        <!-- Informations sur les séries de groupe -->
                    </div>
                </div>
            </div>

            <!-- Onglet GitHub Sync -->
            <div id="githubsync-tab" class="tab-content">
                <h2>🐙 Synchronisation GitHub</h2>
                
                <!-- Contenu verrouillé -->
                <div id="github-locked-content" class="locked-content">
                    <div class="lock-icon">🔒</div>
                    <p>Accès restreint aux paramètres de synchronisation</p>
                    <button id="unlock-github" class="pixel-btn primary">Déverrouiller</button>
                </div>

                <!-- Contenu déverrouillé -->
                <div id="github-unlocked-content" class="hidden">
                    <div class="github-status">
                        <div id="github-status">❌ Non configuré</div>
                    </div>

                    <div class="github-section">
                        <h3>Configuration</h3>
                        <div class="form-group">
                            <label for="github-token">Token GitHub:</label>
                            <input type="password" id="github-token" class="pixel-input" placeholder="ghp_...">
                        </div>
                        <div class="github-controls">
                            <button id="test-github-token" class="pixel-btn secondary">Tester</button>
                            <button id="start-sync" class="pixel-btn primary">Démarrer Sync</button>
                        </div>
                    </div>

                    <div class="github-section">
                        <h3>Options</h3>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="auto-backup"> Sauvegarde automatique
                            </label>
                            <label>
                                <input type="checkbox" id="public-profile"> Profil public
                            </label>
                            <label>
                                <input type="checkbox" id="share-statistics"> Partager les statistiques
                            </label>
                        </div>
                    </div>

                    <div class="github-section">
                        <button id="restore-github-data" class="pixel-btn secondary">Restaurer depuis GitHub</button>
                    </div>
                </div>
            </div>

            <!-- Onglet Succès -->
            <div id="achievements-tab" class="tab-content">
                <h2>🏆 Tous les Succès</h2>
                <div id="achievements-grid" class="achievements-grid">
                    <!-- Les succès seront chargés dynamiquement -->
                </div>
            </div>

            <!-- Onglet Paramètres -->
            <div id="settings-tab" class="tab-content">
                <h2>⚙️ Paramètres</h2>
                
                <div class="settings-section">
                    <h3>🔊 Son</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="sound-enabled" checked>
                        <span>Activer les sons</span>
                    </label>
                </div>

                <div class="settings-section">
                    <h3>⏰ Minuteur personnalisé</h3>
                    <div class="custom-timer-settings">
                        <div class="form-group">
                            <label for="custom-work">Temps de travail (min):</label>
                            <input type="number" id="custom-work" class="pixel-input" value="45" min="1" max="120">
                        </div>
                        <div class="form-group">
                            <label for="custom-short-break">Pause courte (min):</label>
                            <input type="number" id="custom-short-break" class="pixel-input" value="10" min="1" max="30">
                        </div>
                        <div class="form-group">
                            <label for="custom-long-break">Pause longue (min):</label>
                            <input type="number" id="custom-long-break" class="pixel-input" value="20" min="1" max="60">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Profil (ИСПРАВЛЕНО: добавлены поля для фото и etudes) -->
            <div id="profile-tab" class="tab-content">
                <h2>👤 Profil Utilisateur</h2>
                
                <div class="profile-section">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            <img id="user-photo" src="default.png" alt="Photo de profil" style="width:64px;height:64px;border-radius:8px;">
                            <input type="file" id="photo-upload" accept="image/*" style="margin-top:8px;" class="pixel-input">
                        </div>
                        <div class="profile-info">
                            <h2 id="profile-username">MaîtreÉtude</h2>
                            <p>Niveau <span id="profile-level">5</span> • <span id="profile-points">1250</span> points</p>
                            <p>Dernière connexion: <span id="last-login">aujourd'hui</span></p>
                        </div>
                    </div>
                    
                    <div class="profile-details">
                        <h3>Etudes</h3>
                        <input type="text" id="profile-etudes" class="pixel-input" placeholder="Entrez vos etudes" />
                        
                        <h3>📁 Gestion des Données</h3>
                        <p>Exportez vos données pour une sauvegarde ou importez depuis un fichier.</p>
                        <div class="data-controls">
                            <button id="export-data" class="pixel-btn secondary">Exporter</button>
                            <button id="import-data" class="pixel-btn secondary">Importer</button>
                            <input type="file" id="import-file" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modales -->
    <!-- Modal de mot de passe GitHub -->
    <div id="github-password-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>🔐 Accès Administrateur</h3>
                <button id="close-password-modal" class="close-btn">×</button>
            </div>
            <div class="modal-body">
                <p>Entrez le mot de passe d'administration :</p>
                <input type="password" id="github-admin-password" class="pixel-input" placeholder="Mot de passe...">
                <div id="password-error" class="error-message hidden">Mot de passe incorrect</div>
            </div>
            <div class="modal-footer">
                <button id="confirm-password" class="pixel-btn primary">Confirmer</button>
                <button id="cancel-password" class="pixel-btn secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal minuteur personnalisé -->
    <div id="custom-timer-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>⚙️ Minuteur Personnalisé</h3>
                <button id="close-custom-modal" class="close-btn">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-work-time">Temps de travail (minutes):</label>
                    <input type="number" id="modal-work-time" class="pixel-input" value="45" min="1" max="120">
                </div>
                <div class="form-group">
                    <label for="modal-short-break">Pause courte (minutes):</label>
                    <input type="number" id="modal-short-break" class="pixel-input" value="10" min="1" max="30">
                </div>
                <div class="form-group">
                    <label for="modal-long-break">Pause longue (minutes):</label>
                    <input type="number" id="modal-long-break" class="pixel-input" value="20" min="1" max="60">
                </div>
                <div class="form-group">
                    <label for="modal-cycles">Nombre de cycles:</label>
                    <input type="number" id="modal-cycles" class="pixel-input" value="3" min="1" max="10">
                </div>
            </div>
            <div class="modal-footer">
                <button id="save-custom-timer" class="pixel-btn primary">Sauvegarder</button>
                <button id="cancel-custom-timer" class="pixel-btn secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Zone de notifications -->
    <div id="notifications-container"></div>

    <!-- Sons d'alerte -->
    <audio id="sound-start" preload="auto">
        <source src="sounds/start.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-complete" preload="auto">
        <source src="sounds/complete.mp3" type="audio/mpeg">
    </audio>
    <audio id="sound-error" preload="auto">
        <source src="sounds/error.mp3" type="audio/mpeg">
    </audio>

    <script src="app-final.js"></script>
</body>
</html>